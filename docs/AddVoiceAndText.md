# 在照片上加语音，加信息

## 概述

添加语音和文本和即时上传模块的耦合并不紧密，可以在照片从相机同步到手机之后的任意时刻开启，本质上你可以单独的保存声音和文本的信息，只要在之后对这些信息和同步到云端的信息进行关联即可。

## 流程

这里分为两种流程，需要分别进行处理，主要的区别在于，如果相片还没上传成功，这个时候，还没有云端的photo id ,则如果需要进行关联，需要现在本地保存照片以及声音等信息的关联关系，然后可以选择同时将照片和附加信息上传到服务器端（下图1展示的情况），也可以等待照片上传完成之后，拿到photo id, 再次上传附件信息，类似（图2）

### 照片只上传到手机端，还未上传到云端的情况

图1

```
+------------------------------------------------+
|                  Camera                        |
+----------------------+-------------------------+
                       |
                       | transport
+----------------------v-------------------------+
|                Photo in Android Device         |
+----------------------+-------------------------+
                       |
                       | Record Voice
                       |
+----------------------v--------------------------+
|Local DB to store relation between photo and voice etc...
+----------------------+--------------------------+
                       |
                       | Upload both photo and Voice to cloud
+----------------------v-------------------------+
|                  Cloud space                   |
+------------------------------------------------+
```

### 照片已经上传到云端的情况

图2

```
+------------------------------------------------+
|                  Camera                        |
+----------------------+-------------------------+
                       |
                       | transport
+----------------------v-------------------------+
|                Photo in Android Device         |
+--+--------+----------------+-------------------+
   |        ^                |
   |        |                | record Voice etc..
   | upload |        +-------v-------------------+
   |        |        |                           |
   |        |        +-------+-------------------+
   |Get photo ID             |
   |        |                | upload Voice and Photo ID
   |        |                |
+--v--------+----------v-----v-------------------+
|                  Cloud space                   |
+------------------------------------------------+
```
